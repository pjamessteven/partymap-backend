<!DOCTYPE html>
<html class="js wf-ubuntu-i4-active wf-ubuntu-n7-active wf-ubuntu-i7-active wf-ubuntu-n4-active wf-active" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><script src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/webfont.js" type="text/javascript" async=""></script><script src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/analytics.js" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app12.us.archive.org';v.server_ms=460;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/ait-client-rewrite.js" charset="utf-8"></script>
<script type="text/javascript">
WB_wombat_Init("https://web.archive.org/web/", "20171012215728", "onethinglab.com");
</script>
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/wbhack.js" charset="utf-8"></script>
<script type="text/javascript">
__wbhack.init('https://web.archive.org/web');
</script>
<link rel="stylesheet" type="text/css" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/banner-styles.css">
<link rel="stylesheet" type="text/css" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/iconochive.css">
<!-- End Wayback Rewrite JS Include -->

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="https://onethinglab.com/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="https://s0.wp.com/wp-content/themes/pub/twentyfifteen/js/html5.js"></script>
	<![endif]-->
	<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Server-side Markers clustering using PostgreSQL + PostGIS and NodeJS – Blog about satisfying the programming itch…</title>
<script type="text/javascript">
  WebFontConfig = {"google":{"families":["Ubuntu:r:latin,latin-ext","Ubuntu:r,i,b,bi:latin,latin-ext"]}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://web.archive.org/web/20171012215728/https://s1.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active body, .wf-active button, .wf-active input, .wf-active select, .wf-active textarea{font-family:"Ubuntu",sans-serif}.wf-active blockquote cite, .wf-active blockquote small{font-family:"Ubuntu",sans-serif}.wf-active ::-webkit-input-placeholder{font-family:"Ubuntu",sans-serif}.wf-active :-moz-placeholder{font-family:"Ubuntu",sans-serif}.wf-active ::-moz-placeholder{font-family:"Ubuntu",sans-serif}.wf-active :-ms-input-placeholder{font-family:"Ubuntu",sans-serif}.wf-active button, .wf-active input[type="button"], .wf-active input[type="reset"], .wf-active input[type="submit"]{font-family:"Ubuntu",sans-serif}.wf-active .post-password-form label{font-family:"Ubuntu",sans-serif}.wf-active .main-navigation .menu-item-description{font-family:"Ubuntu",sans-serif}.wf-active .post-navigation .meta-nav{font-family:"Ubuntu",sans-serif}.wf-active .post-navigation .post-title{font-family:"Ubuntu",sans-serif}.wf-active .pagination{font-family:"Ubuntu",sans-serif}.wf-active .comment-navigation, .wf-active .image-navigation{font-family:"Ubuntu",sans-serif}.wf-active .site .skip-link{font-family:"Ubuntu",sans-serif}.wf-active .logged-in .site .skip-link{font-family:"Ubuntu",sans-serif}.wf-active .site-description{font-family:"Ubuntu",sans-serif}.wf-active .widget_calendar caption{font-family:"Ubuntu",sans-serif}.wf-active .widget_rss .rss-date, .wf-active .widget_rss cite{font-family:"Ubuntu",sans-serif}.wf-active .author-heading{font-family:"Ubuntu",sans-serif}.wf-active .entry-footer{font-family:"Ubuntu",sans-serif}.wf-active .page-links{font-family:"Ubuntu",sans-serif}.wf-active .entry-caption{font-family:"Ubuntu",sans-serif}.wf-active .comment-metadata, .wf-active .pingback .edit-link{font-family:"Ubuntu",sans-serif}.wf-active .comment-list .reply a{font-family:"Ubuntu",sans-serif}.wf-active .comment-form label{font-family:"Ubuntu",sans-serif}.wf-active .comment-awaiting-moderation, .wf-active .comment-notes, .wf-active .form-allowed-tags, .wf-active .logged-in-as{font-family:"Ubuntu",sans-serif}.wf-active .no-comments{font-family:"Ubuntu",sans-serif}.wf-active .wp-caption-text{font-family:"Ubuntu",sans-serif}.wf-active .gallery-caption{font-family:"Ubuntu",sans-serif}.wf-active h1, .wf-active h2:not(.site-description), .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"Ubuntu",sans-serif;font-weight:400;font-style:normal}.wf-active .site-title{font-family:"Ubuntu",sans-serif;font-weight:400;font-style:normal}.wf-active .widget-title{font-family:"Ubuntu",sans-serif;font-style:normal;font-weight:400}.wf-active .entry-title{font-style:normal;font-weight:400}.wf-active .comment-content h1, .wf-active .entry-content h1, .wf-active .entry-summary h1, .wf-active .page-content h1{font-style:normal;font-weight:400}.wf-active .comment-content h2, .wf-active .entry-content h2, .wf-active .entry-summary h2, .wf-active .page-content h2{font-style:normal;font-weight:400}.wf-active .comment-content h3, .wf-active .entry-content h3, .wf-active .entry-summary h3, .wf-active .page-content h3{font-style:normal;font-weight:400}.wf-active .comment-content h4, .wf-active .comment-content h5, .wf-active .comment-content h6, .wf-active .entry-content h4, .wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h4, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .page-content h4, .wf-active .page-content h5, .wf-active .page-content h6{font-style:normal;font-weight:400}.wf-active .page-title{font-family:"Ubuntu",sans-serif;font-style:normal;font-weight:400}.wf-active .format-aside .entry-title, .wf-active .format-audio .entry-title, .wf-active .format-chat .entry-title, .wf-active .format-gallery .entry-title, .wf-active .format-image .entry-title, .wf-active .format-link .entry-title, .wf-active .format-quote .entry-title, .wf-active .format-status .entry-title, .wf-active .format-video .entry-title{font-style:normal;font-weight:400}.wf-active .comment-reply-title, .wf-active .comments-title{font-family:"Ubuntu",sans-serif;font-style:normal;font-weight:400}@media screen and (min-width: 38.75em){.wf-active .site-title{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .site-title{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .widget-title{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .entry-content h1, .wf-active .entry-summary h1, .wf-active .page-content h1, .wf-active .comment-content h1{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .entry-content h2, .wf-active .entry-summary h2, .wf-active .page-content h2, .wf-active .comment-content h2{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .entry-content h3, .wf-active .entry-summary h3, .wf-active .page-content h3, .wf-active .comment-content h3{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .entry-content h4, .wf-active .entry-summary h4, .wf-active .page-content h4, .wf-active .comment-content h4{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .page-content h5, .wf-active .page-content h6, .wf-active .comment-content h5, .wf-active .comment-content h6{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .page-title, .wf-active .comments-title, .wf-active .comment-reply-title, .wf-active .post-navigation .post-title{font-style:normal;font-weight:400}}@media screen and (min-width: 46.25em){.wf-active .format-aside .entry-title, .wf-active .format-image .entry-title, .wf-active .format-video .entry-title, .wf-active .format-quote .entry-title, .wf-active .format-gallery .entry-title, .wf-active .format-status .entry-title, .wf-active .format-link .entry-title, .wf-active .format-audio .entry-title, .wf-active .format-chat .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .site-title{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .widget-title{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .entry-content h1, .wf-active .entry-summary h1, .wf-active .page-content h1, .wf-active .comment-content h1{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .entry-content h2, .wf-active .entry-summary h2, .wf-active .page-content h2, .wf-active .comment-content h2{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .entry-content h3, .wf-active .entry-summary h3, .wf-active .page-content h3, .wf-active .comment-content h3{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .entry-content h4, .wf-active .entry-summary h4, .wf-active .page-content h4, .wf-active .comment-content h4{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .page-content h5, .wf-active .page-content h6, .wf-active .comment-content h5, .wf-active .comment-content h6{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .page-title, .wf-active .comments-title, .wf-active .comment-reply-title, .wf-active .post-navigation .post-title{font-style:normal;font-weight:400}}@media screen and (min-width: 55em){.wf-active .format-aside .entry-title, .wf-active .format-image .entry-title, .wf-active .format-video .entry-title, .wf-active .format-quote .entry-title, .wf-active .format-gallery .entry-title, .wf-active .format-status .entry-title, .wf-active .format-link .entry-title, .wf-active .format-audio .entry-title, .wf-active .format-chat .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .site-title{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .widget-title{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .entry-content h1, .wf-active .entry-summary h1, .wf-active .page-content h1, .wf-active .comment-content h1{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .entry-content h2, .wf-active .entry-summary h2, .wf-active .page-content h2, .wf-active .comment-content h2{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .entry-content h3, .wf-active .entry-summary h3, .wf-active .page-content h3, .wf-active .comment-content h3{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .entry-content h4, .wf-active .entry-summary h4, .wf-active .page-content h4, .wf-active .comment-content h4{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .page-content h5, .wf-active .page-content h6, .wf-active .comment-content h5, .wf-active .comment-content h6{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .page-title, .wf-active .comments-title, .wf-active .comment-reply-title, .wf-active .post-navigation .post-title{font-style:normal;font-weight:400}}@media screen and (min-width: 59.6875em){.wf-active .format-aside .entry-title, .wf-active .format-image .entry-title, .wf-active .format-video .entry-title, .wf-active .format-quote .entry-title, .wf-active .format-gallery .entry-title, .wf-active .format-status .entry-title, .wf-active .format-link .entry-title, .wf-active .format-audio .entry-title, .wf-active .format-chat .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .site-title{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .widget-title{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .entry-content h1, .wf-active .entry-summary h1, .wf-active .page-content h1, .wf-active .comment-content h1{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .entry-content h2, .wf-active .entry-summary h2, .wf-active .page-content h2, .wf-active .comment-content h2{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .entry-content h3, .wf-active .entry-summary h3, .wf-active .page-content h3, .wf-active .comment-content h3{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .entry-content h4, .wf-active .entry-summary h4, .wf-active .page-content h4, .wf-active .comment-content h4{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .page-content h5, .wf-active .page-content h6, .wf-active .comment-content h5, .wf-active .comment-content h6{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .page-title, .wf-active .comments-title, .wf-active .comment-reply-title, .wf-active .post-navigation .post-title{font-style:normal;font-weight:400}}@media screen and (min-width: 68.75em){.wf-active .format-aside .entry-title, .wf-active .format-image .entry-title, .wf-active .format-video .entry-title, .wf-active .format-quote .entry-title, .wf-active .format-gallery .entry-title, .wf-active .format-status .entry-title, .wf-active .format-link .entry-title, .wf-active .format-audio .entry-title, .wf-active .format-chat .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .site-title{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .widget-title{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .entry-title{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .entry-content h1, .wf-active .entry-summary h1, .wf-active .page-content h1, .wf-active .comment-content h1{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .entry-content h2, .wf-active .entry-summary h2, .wf-active .page-content h2, .wf-active .comment-content h2{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .entry-content h3, .wf-active .entry-summary h3, .wf-active .page-content h3, .wf-active .comment-content h3{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .entry-content h4, .wf-active .entry-summary h4, .wf-active .page-content h4, .wf-active .comment-content h4{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .entry-content h5, .wf-active .entry-content h6, .wf-active .entry-summary h5, .wf-active .entry-summary h6, .wf-active .page-content h5, .wf-active .page-content h6, .wf-active .comment-content h5, .wf-active .comment-content h6{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .page-title, .wf-active .comments-title, .wf-active .comment-reply-title, .wf-active .post-navigation .post-title{font-style:normal;font-weight:400}}@media screen and (min-width: 77.5em){.wf-active .format-aside .entry-title, .wf-active .format-image .entry-title, .wf-active .format-video .entry-title, .wf-active .format-quote .entry-title, .wf-active .format-gallery .entry-title, .wf-active .format-status .entry-title, .wf-active .format-link .entry-title, .wf-active .format-audio .entry-title, .wf-active .format-chat .entry-title{font-style:normal;font-weight:400}}</style>
		<script src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/remote-login.js" type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel="dns-prefetch" href="https://web.archive.org/web/20171012215728/https://s2.wp.com/">
<link rel="dns-prefetch" href="https://web.archive.org/web/20171012215728/https://s0.wp.com/">
<link rel="dns-prefetch" href="https://web.archive.org/web/20171012215728/https://onethinglab.wordpress.com/">
<link rel="dns-prefetch" href="https://web.archive.org/web/20171012215728/https://s1.wp.com/">
<link rel="dns-prefetch" href="https://web.archive.org/web/20171012215728/https://fonts.googleapis.com/">
<link href="https://web.archive.org/web/20171012215728/https://fonts.gstatic.com/" crossorigin="" rel="preconnect">
<link rel="alternate" type="application/rss+xml" title="Blog about satisfying the programming itch... » Feed" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Blog about satisfying the programming itch... » Comments Feed" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Blog about satisfying the programming itch... » Server-side Markers clustering using PostgreSQL + PostGIS and&nbsp;NodeJS Comments Feed" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/feed/">
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/s0.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1505864856h&ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="all-css-0-1" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/a.css" type="text/css" media="all">
<link rel="stylesheet" id="twentyfifteen-fonts-css" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/css.css" type="text/css" media="all">
<link rel="stylesheet" id="all-css-2-1" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/a_002.css" type="text/css" media="all">
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentyfifteen-ie-css'  href='https://s0.wp.com/wp-content/themes/pub/twentyfifteen/css/ie.css?m=1421363535h&#038;ver=20141010' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentyfifteen-ie7-css'  href='https://s0.wp.com/wp-content/themes/pub/twentyfifteen/css/ie7.css?m=1418225460h&#038;ver=20141010' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="all-css-6-1" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/a_003.css" type="text/css" media="all">
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/a_003.js"></script>
<link rel="stylesheet" id="all-css-0-2" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/style.css" type="text/css" media="all">
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s1.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://onethinglab.wordpress.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="OpenLayers: Align label with Line&nbsp;Feature" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/11/openlayers-align-label-with-line-feature/">
<link rel="next" title="The Definitive Guide to Google Maps&nbsp;Markers" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/06/04/the-definitive-guide-to-google-maps-markers/">
<meta name="generator" content="WordPress.com">
<link rel="canonical" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/">
<link rel="shortlink" href="https://web.archive.org/web/20171012215728/http://wp.me/p8HPSR-1X">
<link rel="alternate" type="application/json+oembed" href="https://web.archive.org/web/20171012215728/https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fonethinglab.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F&amp;for=wpcom-auto-discovery"><link rel="alternate" type="application/xml+oembed" href="https://web.archive.org/web/20171012215728/https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fonethinglab.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F&amp;for=wpcom-auto-discovery">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article">
<meta property="og:title" content="Server-side Markers clustering using PostgreSQL + PostGIS and NodeJS">
<meta property="og:url" content="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/">
<meta property="og:description" content="In this post I will discuss clustering of points on server side using combination of PostgreSQL and PostGIS extension. Then there will be presented NodeJS application, which simply pulls data from …">
<meta property="article:published_time" content="2017-05-16T11:45:03+00:00">
<meta property="article:modified_time" content="2017-06-07T08:59:08+00:00">
<meta property="og:site_name" content="Blog about satisfying the programming itch...">
<meta property="og:image" content="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png">
<meta property="og:image:width" content="1036">
<meta property="og:image:height" content="573">
<meta property="og:locale" content="en_US">
<meta name="twitter:site" content="@wordpressdotcom">
<meta name="twitter:text:title" content="Server-side Markers clustering using PostgreSQL + PostGIS and&nbsp;NodeJS">
<meta name="twitter:image" content="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=240">
<meta name="twitter:card" content="summary">
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom">
<link rel="search" type="application/opensearchdescription+xml" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/osd.xml" title="Blog about satisfying the programming itch...">
<link rel="search" type="application/opensearchdescription+xml" href="https://web.archive.org/web/20171012215728/https://s1.wp.com/opensearch.xml" title="WordPress.com">
<meta name="theme-color" content="#f1f1f1">
<meta name="application-name" content="Blog about satisfying the programming itch..."><meta name="msapplication-window" content="width=device-width;height=device-height"><meta name="msapplication-tooltip" content="&quot;Write programs that do one thing and do it well&quot; - Unix philosophy"><meta name="msapplication-task" content="name=Subscribe;action-uri=https://onethinglab.com/feed/;icon-uri=https://onethinglab.files.wordpress.com/2017/05/cropped-site_icon.png?w=16"><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico"><meta name="title" content="Server-side Markers clustering using PostgreSQL + PostGIS and&nbsp;NodeJS | Blog about satisfying the programming itch... on WordPress.com">
<meta name="description" content="In this post I will discuss clustering of points on server side using combination of PostgreSQL and PostGIS extension. Then there will be presented NodeJS application, which simply pulls data from database using set of latitude and longitude describing interested area. Why to cluster places? Suppose you&nbsp;are working on a&nbsp;website which allows everyone to pay…">
	<style type="text/css" id="twentyfifteen-header-css">
			.site-header {

			/*
			 * No shorthand so the Customizer can override individual properties.
			 * @see https://core.trac.wordpress.org/ticket/31460
			 */
			background-image: url(https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/cropped-topography.png);
			background-repeat: no-repeat;
			background-position: 50% 50%;
			-webkit-background-size: cover;
			-moz-background-size:    cover;
			-o-background-size:      cover;
			background-size:         cover;
		}

		@media screen and (min-width: 59.6875em) {
			body:before {

				/*
				 * No shorthand so the Customizer can override individual properties.
				 * @see https://core.trac.wordpress.org/ticket/31460
				 */
				background-image: url(https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/cropped-topography.png);
				background-repeat: no-repeat;
				background-position: 100% 50%;
				-webkit-background-size: cover;
				-moz-background-size:    cover;
				-o-background-size:      cover;
				background-size:         cover;
				border-right: 0;
			}

			.site-header {
				background: transparent;
			}
		}
		</style>
	<link rel="amphtml" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/amp/"><link rel="stylesheet" type="text/css" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/shCore.css"><link rel="stylesheet" type="text/css" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
<link rel="icon" href="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/cropped-site_icon.png?w=32" sizes="32x32">
<link rel="icon" href="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/cropped-site_icon.png?w=192" sizes="192x192">
<link rel="apple-touch-icon-precomposed" href="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/cropped-site_icon.png?w=180">
<meta name="msapplication-TileImage" content="https://onethinglab.files.wordpress.com/2017/05/cropped-site_icon.png?w=270">
<style type="text/css"></style><link rel="stylesheet" type="text/css" id="gravatar-card-css" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/hovercard.css"><link rel="stylesheet" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/css_002.css" media="all"><link rel="stylesheet" type="text/css" id="gravatar-card-services-css" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/services.css"></head>

<body class="post-template-default single single-post postid-121 single-format-standard mp6 customizer-styles-applied has-site-logo highlander-enabled highlander-light"><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/timestamp.js" charset="utf-8"></script>
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/graph-calc.js" charset="utf-8"></script>
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/auto-complete.js" charset="utf-8"></script>
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/toolbar.js" charset="utf-8"></script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  /*min-width:800px !important;*/
}
.wb-autocomplete-suggestions {
    text-align: left; cursor: default; border: 1px solid #ccc; border-top: 0; background: #fff; box-shadow: -1px 1px 3px rgba(0,0,0,.1);
    position: absolute; display: none; z-index: 2147483647; max-height: 254px; overflow: hidden; overflow-y: auto; box-sizing: border-box;
}
.wb-autocomplete-suggestion { position: relative; padding: 0 .6em; line-height: 23px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 1.02em; color: #333; }
.wb-autocomplete-suggestion b { font-weight: bold; }
.wb-autocomplete-suggestion.selected { background: #f0f0f0; }
</style>
<div id="wm-ipp-base" style="display: block; direction: ltr;" lang="en">
</div><script type="text/javascript">
__wm.bt(600,27,25,2,"web","https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/","2017-10-12",1996,"/_static/",['css/banner-styles.css','css/iconochive.css']);
__wm.checkScreenShot("https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/", '20171012215728');
</script><div class="wb-autocomplete-suggestions "></div>
<!-- END WAYBACK TOOLBAR INSERT -->
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<div id="sidebar" class="sidebar" style="top: 3000.4166870117188px;">
		<header id="masthead" class="site-header" role="banner">
			<div class="site-branding">
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/" class="site-logo-link" rel="home"><img src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/earth_logo.png" class="site-logo attachment-twentyfifteen-logo" alt="" data-size="twentyfifteen-logo" data-attachment-id="204" data-permalink="https://web.archive.org/web/20171012215728/https://onethinglab.com/earth_logo/" data-orig-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/earth_logo.png" data-orig-size="48,48" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="earth_logo" data-image-description="" data-medium-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/earth_logo.png?w=48" data-large-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/earth_logo.png?w=48" width="48" height="48"></a>
										<p class="site-title"><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/" rel="home">Blog about satisfying the programming itch…</a></p>
											<p class="site-description">"Write programs that do one thing and do it well" – Unix philosophy</p>
									<button class="secondary-toggle">Menu and widgets</button>
			</div><!-- .site-branding -->
		</header><!-- .site-header -->

			<div id="secondary" class="secondary">

		
		
					<div id="widget-area" class="widget-area" role="complementary">
						<aside id="recent-posts-3" class="widget widget_recent_entries">		<h2 class="widget-title">Recent Posts</h2>		<ul>
					<li>
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/09/13/jenkins-managing-multiple-jobs-parameters/">Jenkins – Managing multiple jobs&nbsp;parameters</a>
						</li>
					<li>
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/08/29/matplotlib-tutorial-plotting-most-popular-iphone-applications-size-over-time/">Matplotlib Tutorial: Plotting most popular iPhone applications size over&nbsp;time</a>
						</li>
					<li>
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/08/01/bootstrap-vs-custom-css/">Bootstrap vs Custom&nbsp;CSS</a>
						</li>
					<li>
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/06/07/axis-order-what-number-comes-first-longitude-or-latitude/">Axis Order – What number comes first longitude or&nbsp;latitude?</a>
						</li>
					<li>
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/06/04/the-definitive-guide-to-google-maps-markers/">The Definitive Guide to Google Maps&nbsp;Markers</a>
						</li>
					<li>
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/">Server-side Markers clustering using PostgreSQL + PostGIS and&nbsp;NodeJS</a>
						</li>
					<li>
				<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/11/openlayers-align-label-with-line-feature/">OpenLayers: Align label with Line&nbsp;Feature</a>
						</li>
				</ul>
		</aside>		<aside id="wp_tag_cloud-3" class="widget wp_widget_tag_cloud"><h2 class="widget-title">Tags</h2><div style="overflow:hidden"><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/bootstrap/" class="tag-cloud-link tag-link-114042 tag-link-position-1" style="font-size: 8pt;" aria-label="Bootstrap (1 item)">Bootstrap</a>
<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/google-maps-markers/" class="tag-cloud-link tag-link-176729015 tag-link-position-2" style="font-size: 8pt;" aria-label="Google-Maps-Markers (1 item)">Google-Maps-Markers</a>
<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/jenkins/" class="tag-cloud-link tag-link-351789 tag-link-position-3" style="font-size: 8pt;" aria-label="Jenkins (1 item)">Jenkins</a>
<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/nodejs/" class="tag-cloud-link tag-link-31896918 tag-link-position-4" style="font-size: 8pt;" aria-label="NodeJS (1 item)">NodeJS</a>
<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/openlayers/" class="tag-cloud-link tag-link-534055 tag-link-position-5" style="font-size: 8pt;" aria-label="OpenLayers (1 item)">OpenLayers</a>
<a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/postgis/" class="tag-cloud-link tag-link-87049 tag-link-position-6" style="font-size: 8pt;" aria-label="PostGIS (1 item)">PostGIS</a></div></aside><aside id="widget_contact_info-4" class="widget widget_contact_info"><h2 class="widget-title">Contact</h2><div itemscope="" itemtype="http://schema.org/LocalBusiness"><div class="confit-hours" itemprop="openingHours">onethinglab@gmail.com
<br>https://twitter.com/onethinglab</div></div></aside>			</div><!-- .widget-area -->
		
	</div><!-- .secondary -->

	</div><!-- .sidebar -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
<article id="post-121" class="post-121 post type-post status-publish format-standard hentry category-nodejs category-postgis tag-nodejs tag-postgis">
	
	<header class="entry-header">
		<h1 class="entry-title">Server-side Markers clustering using PostgreSQL + PostGIS and&nbsp;NodeJS</h1>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>In this post I will discuss clustering of points on server side 
using combination of PostgreSQL and PostGIS extension. Then there will 
be presented NodeJS application, which simply pulls data from database 
using set of latitude and longitude describing interested area.</p>
<h3>Why to cluster places?</h3>
<p>Suppose you&nbsp;are working on a&nbsp;website which allows everyone 
to pay some fee to plant a tree in chosen location. For each tree there 
is a pin on a map with tree marker and the name of generous person who 
skipped mornings coffee for the sake of restoring forest around the 
world. Now, imagine for a moment when your website became popular and 
you have 10.000 of trees planted in some small area, now your map looks 
like this:</p>
<figure data-shortcode="caption" id="attachment_168" style="width: 1036px" class="wp-caption alignnone"><img data-attachment-id="168" data-permalink="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/tree_pins/" data-orig-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=660" data-orig-size="1036,573" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="tree_pins" data-image-description="" data-medium-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=660?w=300" data-large-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=660?w=660" class="alignnone size-full wp-image-168" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/tree_pins.png" alt="tree_pins" srcset="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=660 660w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=150 150w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=300 300w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=768 768w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png?w=1024 1024w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/tree_pins.png 1036w" sizes="(max-width: 660px) 100vw, 660px"><figcaption class="wp-caption-text">Ughhh, where on earth those trees located?</figcaption></figure>
<p>Wouldn’t it be better to gather trees into&nbsp;some kind of bubble, 
put number of trees on it, so the person could&nbsp;distinguish high 
density of trees and make decision if that’s a good place to plant 
another one?</p>
<figure data-shortcode="caption" id="attachment_189" style="width: 794px" class="wp-caption alignnone"><img data-attachment-id="189" data-permalink="https://web.archive.org/web/20171012215728/https://onethinglab.com/clustered_tree_pins/" data-orig-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png?w=660" data-orig-size="794,514" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="clustered_tree_pins" data-image-description="" data-medium-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png?w=660?w=300" data-large-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png?w=660?w=660" class="alignnone size-full wp-image-189" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/clustered_tree_pins1.png" alt="clustered_tree_pins" srcset="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png?w=660 660w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png?w=150 150w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png?w=300 300w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png?w=768 768w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/clustered_tree_pins1.png 794w" sizes="(max-width: 660px) 100vw, 660px"><figcaption class="wp-caption-text">yes, that’s much better</figcaption></figure>
<h3>Installing and Setup Prerequisite Software</h3>
<p>Here is the list of what need to be installed beforehand:</p>
<ul>
<li>PostgreSQL</li>
<li><a href="https://web.archive.org/web/20171012215728/http://postgis.net/" target="_blank" rel="noopener noreferrer">PostGIS</a>&nbsp;extension</li>
<li>NodeJS</li>
</ul>
<p>When the installation of PostgreSQL + PostGIS is done, we need to create new database and enable PostGIS extension. Now fire up <a href="https://web.archive.org/web/20171012215728/http://postgresguide.com/utilities/psql.html" target="_blank" rel="noopener noreferrer">psql </a>in terminal and type the following commands:</p>
<pre class="brush: bash; title: ; notranslate" title="">
# start psql with default postgres user

psql -U postgres

# create database where our places will be located

CREATE DATABASE trees;

# work on trees database

\connect trees;

# now enable PostGIS extension, so we can use all spatial functions, data types, etc

CREATE EXTENSION postgis;

</pre>
<h3>Clustering algorithm</h3>
<p>In our case there will be used pretty simple clustering approach:</p>
<ul>
<li>Get any point that not part of existing cluster.</li>
<li>Find all points in predefined radius that not part of existing cluster.</li>
<li>Mark found points that they belong to particular cluster.</li>
<li>Repeat while there will be no free points without cluster.</li>
</ul>
<h3>PostgreSQL + PostGIS implementation</h3>
<p>Before start writing SQL queries we need to understand the basic idea
 of clustering points. There will be implemented dummy approach of 
finding points in specific radius and this radius will be defined for 
each zoom level. So,&nbsp;when on zoom level two: the radius will be 100
 km and then while zooming in: the radius will be approximately divided 
by two. This is slow solution as for each zoom level we need to gather 
all points using different radius, the more optimized solution will be 
clustering on largest zoom level and then&nbsp;using clustered points as
 input to clustering for upper zoom level and so on.</p>
<p>Now we want to create table named <em>places</em>, with place 
latitude and longitude and cluster id for each zoom level. Cluster id 
is&nbsp;additional column to identify cluster this point belongs to. For
 each zoom level the additional table will be created with the name <em>clusters_zoom</em></p>
<pre class="brush: sql; title: ; notranslate" title="">
-- create table places and columns named cluster&lt;n&gt;
-- where n - is the cluster for specific zoom level.
-- In our case we want to cluster points in zoom level range [2..16]

CREATE TABLE places(id SERIAL PRIMARY KEY,
                    place GEOGRAPHY,
                    cluster2 INTEGER,
                    cluster3 INTEGER,
                    cluster4 INTEGER,
                    cluster5 INTEGER,
                    cluster6 INTEGER,
                    cluster7 INTEGER,
                    cluster8 INTEGER,
                    cluster9 INTEGER,
                    cluster10 INTEGER,
                    cluster11 INTEGER,
                    cluster12 INTEGER,
                    cluster13 INTEGER,
                    cluster14 INTEGER,
                    cluster15 INTEGER,
                    cluster16 INTEGER,
                    dummy INTEGER);
-- create table for each zoom level with the following fields:
-- cluster: id of this cluster, this will be stored in cluster&lt;n&gt; column
-- places table.
-- pt_count: number of points in this cluster
-- centroid: average position of all the points in cluster
CREATE TABLE clusters_zoom_2(cluster SERIAL PRIMARY KEY,
                             pt_count INTEGER,
                             centroid GEOMETRY);
</pre>
<p>First of all we need sample data with places we want to cluster. The 
easiest way is to generate random points in predefined bounding box. In 
our example the bounding box will be located in San Francisco:</p>
<figure data-shortcode="caption" id="attachment_264" style="width: 1092px" class="wp-caption alignnone"><img data-attachment-id="264" data-permalink="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/sf_bbox/" data-orig-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=660" data-orig-size="1092,775" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sf_bbox" data-image-description="" data-medium-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=660?w=300" data-large-file="https://web.archive.org/web/20171012215728/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=660?w=660" class="alignnone size-full wp-image-264" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/sf_bbox.png" alt="sf_bbox" srcset="https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=660 660w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=150 150w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=300 300w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=768 768w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png?w=1024 1024w, https://web.archive.org/web/20171012215728im_/https://onethinglab.files.wordpress.com/2017/05/sf_bbox.png 1092w" sizes="(max-width: 660px) 100vw, 660px"><figcaption class="wp-caption-text">Sample data generated in bounding box.</figcaption></figure>
<pre class="brush: sql; title: ; notranslate" title="">-- generate 10.000 random points in bounding box with coordinates (longitude, latitude):
-- south-west: (-122.51478829956056, 37.686456995336954)
-- north-east: (-122.3220125732422, 37.79505521136725)
DO
$do$
BEGIN
 FOR i IN 1..10000 LOOP
  INSERT INTO places(place, dummy) VALUES (ST_MakePoint(
    random()*(-122.3220125732422 - -122.51478829956056) + -122.51478829956056,
    random()*(37.79505521136725 - 37.686456995336954) + 37.686456995336954
    ), i);
 END LOOP;
END
$do$;
-- create index on places table
CREATE INDEX places_index ON places USING GIST (place);
</pre>
<p>Here is the&nbsp;main SQL function which is executed for each zoom 
level and gather points into clusters with the predefined radius. In 
this example the function is hard-coded for zoom level two and will be 
automated to execute for each zoom level in NodeJS module.</p>
<p>The <em>make_cluster</em> function is pretty straightforward:</p>
<p>All&nbsp;points are gathered using&nbsp;<a href="https://web.archive.org/web/20171012215728/https://postgis.net/docs/ST_DWithin.html" target="_blank" rel="noopener noreferrer">ST_DWithin</a>&nbsp;function, which returns all geometries within the specified distance of one another. Pay attention to the fact that <em>ST_DWithin</em> takes&nbsp;as input geometry or <a href="https://web.archive.org/web/20171012215728/https://postgis.net/docs/geography.html" target="_blank" rel="noopener noreferrer">geography</a> type as first parameter and distance as the last one. In our case we use geography as we need to measure distance in meters.</p>
<p>After new cluster is created then the <em>clusters_zoom&nbsp;</em>and <em>places&nbsp;</em>tables are updated with the new cluster id.</p>
<pre class="brush: sql; title: ; notranslate" title="">CREATE FUNCTION make_cluster2() RETURNS INTEGER AS
$$
    DECLARE start_place GEOGRAPHY;
    DECLARE cluster_id INTEGER;
    DECLARE ids INTEGER[];
      BEGIN
        SELECT place INTO start_place FROM places WHERE cluster2 IS NULL limit 1;
        IF start_place is NULL THEN
            RETURN -1;
        END IF;
        SELECT array_agg(id) INTO ids FROM places WHERE cluster2 is NULL AND ST_DWithin(start_place, place, 100000);
        INSERT INTO clusters_zoom_2(pt_count, centroid)
         SELECT count(place), ST_Centroid(ST_Union(place::geometry)) FROM places, unnest(ids) as pid
        WHERE id = pid
        RETURNING cluster INTO cluster_id;
        UPDATE places SET cluster2 = cluster_id FROM unnest(ids) as pid WHERE id = pid;
        RETURN cluster_id;
      END;
$$  LANGUAGE plpgsql;
</pre>
<p>Now, we are running this function to fill <em>clusters_zoom</em> table, while there exists points without cluster assigned to it:</p>
<pre class="brush: sql; title: ; notranslate" title="">DO
$do$
DECLARE cluster_id INTEGER;
BEGIN
    SELECT 0 INTO cluster_id;
    WHILE cluster_id != -1
    LOOP
     SELECT make_cluster2() INTO cluster_id;
    END LOOP;
END
$do$;
</pre>
<h3>NodeJS implementation</h3>
<p>Let’s assume that we have a table with all trees latitude, longitude 
and some additional data specified by user. What we want is to start 
clustering process in background as it takes some time to finish and 
then notify user that all data was processed successfully.</p>
<p>In order to do this we can create separate module called <em>clusterapp.js</em>&nbsp;which will be running as background process&nbsp;with database connection string as input parameter.</p>
<p>Before running <em>clusterapp.js</em>&nbsp;the following Node modules need to be installed:</p>
<ul>
<li><a href="https://web.archive.org/web/20171012215728/https://github.com/vitaly-t/pg-promise" target="_blank" rel="noopener noreferrer">npm install pg-promise</a>&nbsp;–&nbsp;Promises/A+ interface for PostgreSQL</li>
<li><a href="https://web.archive.org/web/20171012215728/https://www.npmjs.com/package/geojson" target="_blank" rel="noopener noreferrer">npm install geojson</a>&nbsp;– GeoJSON module</li>
<li><a href="https://web.archive.org/web/20171012215728/http://jolira.github.io/backgrounder/" target="_blank" rel="noopener noreferrer">npm install backgrounder</a>&nbsp;– Library for creating background workers</li>
</ul>
<p>The source code is pretty simple and&nbsp;automate SQL queries from the steps above:</p>
<pre class="brush: jscript; title: ; notranslate" title="">var fs = require('fs');
var pgp = require('pg-promise')();
var db;

// predefined clustering radius for each zoom level (in meters)
var zoom_level_radius =
{
    16: 100,
    15: 200,
    14: 500,
    13: 1000,
    12: 2000,
    11: 3000,
    10: 4000,
    9: 7000,
    8: 15000,
    7: 25000,
    6: 50000,
    5: 100000,
    4: 200000,
    3: 400000,
    2: 700000
};

process.on('config', (config, callback) =&gt; {
    console.log('clusterapp: Configuration: ', config);
    // connecting to PostgreSQL instance
    // example: postgres://dbname:dbpassword@localhost:5432/places
    db = pgp(config['connection_string']);
    callback();
    start_clustering();
});

String.prototype.format = function()
{
    var formatted = this;
    for (var i = 0; i &lt; arguments.length; i++) {
var regexp = new RegExp('\\{'+i+'\\}', 'gi');
formatted = formatted.replace(regexp, arguments[i]);
}
return formatted;
};
// create cluster table for each zoom level
function create_cluster_zooom_tables() {
db.task(t =&gt; {
        return t.batch([
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [2]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [3]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [4]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [5]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [6]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [7]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [8]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [9]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [10]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [11]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [12]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [13]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                    " centroid GEOMETRY, classify INTEGER);", [14]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                      " centroid GEOMETRY, classify INTEGER);", [15]),
                t.none("CREATE TABLE IF NOT EXISTS clusters_zoom_$1(cluster SERIAL PRIMARY KEY, pt_count INTEGER," +
                       " centroid GEOMETRY, classify INTEGER);", [16])
        ]);
    }).then(data =&gt; {
        console.log("create_cluster_zooom_tables: cluster tables created: " + data);
    }).catch(error =&gt; {
        console.log("create_cluster_zooom_tables:ERROR: " + error);
        finish_clustering({'ERROR': 'Creating tables failed: ' + error});
    });
}

// create make_cluster function for each zoom level
function create_cluster_functions()
{
    var cluster_func_query =
        "CREATE OR REPLACE FUNCTION make_cluster{0}() RETURNS INTEGER AS\n" +
        "$$\n" +
        "DECLARE start_place GEOGRAPHY;\n" +
        "DECLARE cluster_id INTEGER;\n" +
        "DECLARE ids INTEGER[];\n" +
         "BEGIN\n" +
            "SELECT place INTO start_place FROM places WHERE cluster{0} IS NULL limit 1;\n" +
            "IF start_place is NULL THEN\n" +
                "RETURN -1;\n" +
            "END IF;\n" +
            "SELECT array_agg(id) INTO ids FROM places WHERE cluster{0} is NULL AND ST_DWithin(start_place, place, {1});" +
            "INSERT INTO clusters_zoom_{0}(pt_count, centroid)\n" +
            "SELECT count(place), ST_Centroid(ST_Union(place::geometry)) FROM places, unnest(ids) as pid\n" +
            "WHERE id = pid\n" +
            "RETURNING cluster INTO cluster_id;\n" +
            "UPDATE places SET cluster{0} = cluster_id FROM unnest(ids) as pid WHERE id = pid;\n" +
            "RETURN cluster_id;\n" +
        "END;\n" +
        "$$  LANGUAGE plpgsql";

    for (var zoom_level in zoom_level_radius)
    {
        var query_create_func = cluster_func_query.format(zoom_level, zoom_level_radius[zoom_level]);
        db.none(query_create_func)
          .then(result =&gt; {
              console.log("create_cluster_functions: function created successfully");
          })
          .catch(error =&gt; {
              console.log('create_cluster_functions: Creating clustring function failed due: ' + error);
              finish_clustering({'ERROR': 'Creating functions failed: ' + error});
          });
    }
}

// creating cluster for each zoom level
function make_clusters()
{
    var query =
            "DO\n" +
            "$do$\n" +
            "DECLARE cluster_id INTEGER;\n" +
            "BEGIN\n" +
                "SELECT 0 INTO cluster_id;\n" +
                "WHILE cluster_id != -1\n" +
                "LOOP\n" +
                "SELECT make_cluster$1() INTO cluster_id;\n" +
                "END LOOP;\n" +
            "END\n" +
            "$do$;";

    db.task(t =&gt; {
        return t.batch([
                t.none(query, [2]),
                t.none(query, [3]),
                t.none(query, [4]),
                t.none(query, [5]),
                t.none(query, [6]),
                t.none(query, [7]),
                t.none(query, [8]),
                t.none(query, [9]),
                t.none(query, [10]),
                t.none(query, [11]),
                t.none(query, [12]),
                t.none(query, [13]),
                t.none(query, [14]),
                t.none(query, [15]),
                t.none(query, [16])
        ]);
    }).then(data =&gt; {
        console.log("make_clusters: cluster created: " + data);
        finish_clustering({'OK': ''});
    }).catch(error =&gt; {
        console.log("make_clusters:ERROR: " + error);
        finish_clustering({'ERROR': 'Creating clusters failed: ' + error});
    });
}

function start_clustering()
{
    create_cluster_zooom_tables();
    create_cluster_functions();
    make_clusters();
}

function finish_clustering(status)
{
    pgp.end();
    process.send({'status': status});
}
</pre>
<p>After the clustering process is done we need to think about how to 
use it in our application. So, we have backend as PostgreSQL database 
with a bunch of tables with clustered points and we need API layer in 
order to retrieve clusters for selected area and specific zoom level.</p>
<p>In order to gather all points in specific area we can use PostGIS <a href="https://web.archive.org/web/20171012215728/https://postgis.net/docs/geometry_overlaps.html" target="_blank" rel="noopener noreferrer">&amp;&amp;</a>&nbsp;bounding box intersect operator on <em>centroid&nbsp;</em>from clustered points table and actual bounding box of interested area created using&nbsp;<a href="https://web.archive.org/web/20171012215728/https://postgis.net/docs/ST_MakeEnvelope.html" target="_blank" rel="noopener noreferrer">ST_MakeEnvelope</a>&nbsp;function.</p>
<p>Here is the full query:</p>
<pre class="brush: sql; title: ; notranslate" title="">-- get all clusters for second zoom level in area near San Francisco
SELECT cluster,
       pt_count,
       centroid
FROM  clusters_zoom_2
WHERE centroid &amp;&amp; ST_MakeEnvelope(-122.51478829956056, 37.686456995336954,
                                  -122.3220125732422, 37.79505521136725, 4326);
</pre>
<p>In the NodeJS implementation we create <em>api.js&nbsp;</em>module with two endpoints:</p>
<ul>
<li><em>clusters:&nbsp;</em>Getting all clusters at zoom level and bounding box passed as parameter.</li>
<li><em>places:&nbsp;</em>Getting original, non-clustered data at specific zoom level and bounding box.</li>
</ul>
<pre class="brush: jscript; title: ; notranslate" title="">var express = require('express');
var router = express.Router();
var pgp = require('pg-promise')();
var backgrounder = require('backgrounder');
var GeoJSON = require('geojson');
// database connection parametres
var db = pgp('postgres://dbname:dbpassword@localhost:5432/places');

// optimization: define buffer radius for each zoom level
// when retrieving data for specific bounding box
var zoom_level_buffer_radius =
{
    16: 1000,
    15: 1000,
    14: 1000,
    13: 1000,
    12: 1000,
    11: 1500,
    10: 2000,
    9: 3000,
    8: 5000,
    7: 12000,
    6: 25000,
    5: 50000,
    4: 100000,
    3: 100000,
    2: 100000
};

// zoom: zoom level
// ne_lat, ne_lng: north east latitude and longitude
// sw_lat, sw_lng: south west latitude and longitude
// http://localhost:3000/api/clusters?id=&amp;zoom=2&amp;ne_lat=-21.32940556631426&amp;ne_lng=146.66655859374998&amp;sw_lat=-29.266381110600395&amp;sw_lng=115.42144140624998
router.get('/clusters', function(req, res, next) {
    let query_get_clusters = "SELECT cluster, pt_count, ST_X(centroid) as lng, ST_Y(centroid) as lat FROM \n" +
                                    "clusters_zoom_$1 WHERE \n" +
                                    "centroid &amp;&amp; ST_MakeEnvelope($2, $3, $4, $5, 4326);";
    let query_get_buffer = "SELECT ST_XMin(bu::geometry) as sw_lng,\n" +
                                   "ST_YMin(bu::geometry) as sw_lat, ST_XMax(bu::geometry) as ne_lng,\n" +
                                   "ST_YMax(bu::geometry) as ne_lat FROM\n" +
                                   "ST_Buffer(ST_GeographyFromText(ST_AsEWKT(ST_MakeEnvelope($1, $2, $3, $4, 4326))), 1000) as bu;"

    db.manyOrNone(query_get_buffer, [parseFloat(req.query['sw_lng']),
                                     parseFloat(req.query['sw_lat']),
                                     parseFloat(req.query['ne_lng']),
                                     parseFloat(req.query['ne_lat']),
                                     zoom_level_buffer_radius[parseInt(req.query['zoom'])]])
                                     .then(buffered_box_data =&gt; {
                                        db_connection.manyOrNone(query_get_clusters, [parseInt(req.query['zoom']),
                                                                                               buffered_box_data[0].sw_lng,
                                                                                               buffered_box_data[0].sw_lat,
                                                                                               buffered_box_data[0].ne_lng,
                                                                                               buffered_box_data[0].ne_lat])
                                                    .then(clusters_data =&gt; {
                                                        var result = GeoJSON.parse(clusters_data, {Point: ['lat', 'lng']});
                                                        result['buffered_bbox'] = [buffered_box_data[0].sw_lng,
                                                                                   buffered_box_data[0].sw_lat,
                                                                                   buffered_box_data[0].ne_lng,
                                                                                   buffered_box_data[0].ne_lat];
                                                        res.json(result);
                                                    }).catch(error =&gt; {
                                                        console.log(error);
                                                        res.json({'ERROR': 'Invalid request'});
                                                    });
                                                }).catch(error =&gt; {
                                                    console.log(error);
                                                    res.json({'ERROR': 'Invalid request'});
                                                });
});

// ne_lat, ne_lng: north east latitude and longitude
// sw_lat, sw_lng: south west latitude and longitude
// http://localhost:3000/api/places?id=&amp;ne_lat=-21.32940556631426&amp;ne_lng=146.66655859374998&amp;sw_lat=-29.266381110600395&amp;sw_lng=115.42144140624998
router.get('/places', function(req, res, next) {
    let query_string = "SELECT id, ST_X(place::geometry) as lng, ST_Y(place::geometry) as lat \n" +
                       "FROM places WHERE place &amp;&amp; ST_MakeEnvelope($1, $2, $3, $4, 4326);";
    db.manyOrNone(query_string, [parseFloat(req.query['sw_lng']),
                                 parseFloat(req.query['sw_lat']),
                                 parseFloat(req.query['ne_lng']),
                                 parseFloat(req.query['ne_lat'])])
                                 .then(data =&gt; {
                                            res.json(GeoJSON.parse(data, {Point: ['lat', 'lng']}));
                                        }).catch(error =&gt; {
                                            res.json({'ERROR': 'Invalid request'});
                                        });
});

module.exports = router;
</pre>
<p>Now, you can run <em>api.js </em>module and start testing query in 
your browser. The response result for each query will be GeoJSON with 
data that was pulled&nbsp;from database.</p>
<h3>How to use in real application?</h3>
<p>It doesn’t matter what map provider you are using as you have server-side clustering with API layer on top of it.</p>
<p>Here is basic example using google maps, which is listening on <em>bounds_changed </em>event and getting all clusters inside current bounding box:</p>
<pre class="brush: xml; title: ; notranslate" title="">&lt;/pre&gt;
&lt;pre&gt;&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
&lt;style&gt;
       #map {
        height: 800px;
        width: 80%;
       }
    &lt;/style&gt;

  &lt;/head&gt;
  &lt;body&gt;
&lt;div id="map"&gt;&lt;/div&gt;
&lt;script&gt;
        var gmap;

        function show_clusters(zoom, ne_lat, ne_lng, sw_lat, sw_lng, bounds) {
          http_request = new XMLHttpRequest();
          http_request.onreadystatechange = function() {
            if (this.readyState === XMLHttpRequest.DONE) {
              if (this.status === 200) {
                var response = JSON.parse(this.responseText);
                if (response.hasOwnProperty('ERROR')) {
                  console.log('ERROR: ', response['ERROR']);
                } else {
                  response['features'].forEach(feature =&gt; {
                    var pt = {lng: parseFloat(feature['geometry']['coordinates'][0]),
                              lat: parseFloat(feature['geometry']['coordinates'][1])};
                    console.log('cluster: ', pt, ' points: ', feature['properties']['pt_count'].toString());
                  });
                }
              } else {
                console.log('show_clusters: ERROR status: ', this.status);
              }
            }
          };
          var params = 'id=' + id + '&amp;' +
                       'zoom=' + zoom + '&amp;' +
                       'ne_lat=' + ne_lat + '&amp;' +
                       'ne_lng=' + ne_lng + '&amp;' +
                       'sw_lat=' + sw_lat + '&amp;' +
                       'sw_lng=' + sw_lng;

          var query = 'http://localhost:3000/api/clusters?' + params;
          http_request.open('GET', query);
          http_request.send();
        }

        function bounds_changed() {
          var bounds = gmap.getBounds();
          var SW = bounds.getSouthWest();
          var NE = bounds.getNorthEast();

          var ne_lat = NE.lat();
          var ne_lng = NE.lng();
          var sw_lat = SW.lat();
          var sw_lng = SW.lng();

          show_clusters(zoom, ne_lat, ne_lng, sw_lat, sw_lng, bounds);
        }

        function init_map() {
          gmap = new google.maps.Map(document.getElementById('map'),
            {
              zoom: 1,
              center: { lat: -25.363, lng: 131.044 }
            });

          google.maps.event.addListener(gmap, 'bounds_changed', bounds_changed);
        }

    &lt;/script&gt;
    &lt;script src="https://maps.googleapis.com/maps/api/js?callback=init_map"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<h3>Optimization</h3>
<p>As you probably noticed in <em>api.js </em>module, when getting clusters from PostgreSQL there used <a href="https://web.archive.org/web/20171012215728/http://www.postgis.org/docs/ST_Buffer.html" target="_blank" rel="noopener noreferrer">ST_Buffer</a>&nbsp;function,
 which extend bounding box on some predefined distance. This is useful 
when you are trying to get clusters on bounds changed event. It’s better
 to make one query with extended visible area and then use cached result
 when user is panning map than flood your server with query for every 
bounds change.</p>
<p>Another thing that can speed-up clustering process it to perform 
hierarchical clustering. Instead of running the same clustering function
 on all places in your database and just changing the radius basing on 
zoom level, we can run this function on previously clustered data. So, 
for example the input points for clustering function for ninth zoom 
level would be clustered data from tenth zoom level and so on.</p>
<div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-121" class="share-twitter sd-button share-icon" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/?share=twitter&amp;nb=1" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-121" class="share-facebook sd-button share-icon fbc-has-badge fbc-UID_1" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/?share=facebook&amp;nb=1" target="_blank" title="Share on Facebook"><span>Facebook</span></a></li><li class="share-google-plus-1"><a rel="nofollow" data-shared="sharing-google-121" class="share-google-plus-1 sd-button share-icon" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/?share=google-plus-1&amp;nb=1" target="_blank" title="Click to share on Google+"><span>Google</span></a></li><li class="share-end"></li></ul></div></div></div><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-128658237-121-59dfe54d41a60" data-src="//web.archive.org/web/20171012215728oe_/https://widgets.wp.com/likes/#blog_id=128658237&amp;post_id=121&amp;origin=onethinglab.wordpress.com&amp;obj_id=128658237-121-59dfe54d41a60" data-name="like-post-frame-128658237-121-59dfe54d41a60"><h3 class="sd-title">Like this:</h3><div class="likes-widget-placeholder post-likes-widget-placeholder" style="height: 55px;"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></div><span class="sd-text-color"></span><a class="sd-link-color"></a></div></div>	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/" rel="bookmark"><time class="entry-date published" datetime="2017-05-16T11:45:03+00:00">May 16, 2017</time><time class="updated" datetime="2017-06-07T08:59:08+00:00">June 7, 2017</time></a></span><span class="byline"><span class="author vcard"><span class="screen-reader-text">Author </span><a class="url fn n" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/author/pbagrii/">Peter</a></span></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/category/nodejs/" rel="category tag">NodeJS</a>, <a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/category/postgis/" rel="category tag">PostGIS</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/nodejs/" rel="tag">NodeJS</a>, <a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/tag/postgis/" rel="tag">PostGIS</a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

<div id="comments" class="comments-area">

	
	
		<div id="respond" class="comment-respond js">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="https://web.archive.org/web/20171012215728/https://onethinglab.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate="">
				<input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="8ef85ad37b"><input type="hidden" name="_wp_http_referer" value="/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/">
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest">

<div class="comment-form-field comment-textarea">
	
	<div id="comment-form-comment"><textarea tabindex="-1" style="position: absolute; inset: -999px auto auto 0px; border: 0px none; padding: 0px; box-sizing: content-box; overflow-wrap: break-word; height: 0px !important; min-height: 0px !important; overflow: hidden; transition: none 0s ease 0s; font-family: &quot;Noto Serif&quot;, serif; font-size: 14px; font-weight: 400; font-style: normal; letter-spacing: 0px; text-transform: none; text-decoration: rgb(112, 112, 112); word-spacing: 0px; text-indent: 0px; line-height: 23.5833px; width: 584.6px;" class="autosizejs ">Enter your comment here...</textarea><textarea id="comment" name="comment" title="Enter your comment here..." placeholder="Enter your comment here..." style="height: 44px; overflow: hidden; overflow-wrap: break-word; resize: none;"></textarea></div>
</div>

<div id="comment-form-identity" style="display: none;">

	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" title="Guest">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" title="WordPress.com">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" title="Twitter">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" title="Facebook">
					<span></span>
				</a>
			</li>
			<li>
		</li></ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://web.archive.org/web/20171012215728/https://gravatar.com/site/signup/" target="_blank">				<img src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/ad516503a11cd5ca435acc9bb6523536.png" alt="Gravatar" class="no-grav" width="25">
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email"></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text"></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="url"></div>
				</div>
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/ad516503a11cd5ca435acc9bb6523536.png" alt="WordPress.com Logo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="">
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="">
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="">
				<p class="comment-form-posting-as pa-wordpress"><strong></strong> You are commenting using your WordPress.com account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/ad516503a11cd5ca435acc9bb6523536.png" alt="Twitter picture" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="">
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="">
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="">
				<p class="comment-form-posting-as pa-twitter"><strong></strong> You are commenting using your Twitter account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/ad516503a11cd5ca435acc9bb6523536.png" alt="Facebook photo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="">
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="">
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="">
				<p class="comment-form-posting-as pa-facebook"><strong></strong> You are commenting using your Facebook account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/ad516503a11cd5ca435acc9bb6523536.png" alt="Google+ photo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="">
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="">
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="">
				<p class="comment-form-posting-as pa-googleplus"><strong></strong> You are commenting using your Google+ account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function(){
	var input = document.createElement( 'input' ),
	    comment = jQuery( '#comment' );

	if ( 'placeholder' in input ) {
		comment.attr( 'placeholder', jQuery( '.comment-textarea label' ).remove().text() );
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();

	comment.css( { 'height':'10px' } ).one( 'focus', function() {
		var timer = setInterval( HighlanderComments.resizeCallback, 10 )
		jQuery( this ).animate( { 'height': HighlanderComments.initialHeight } ).delay( 100 ).queue( function(n) { clearInterval( timer ); HighlanderComments.resizeCallback(); n(); } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
}
jQuery(document).ready( highlander_expando_javascript );
</script>

<div id="comment-form-subscribe" style="display: none;">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;"> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p></div>




<p class="form-submit" style="display: none;"><input name="submit" type="submit" id="comment-submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="121" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="d3e181aa48"></p>
<input type="hidden" name="genseq" value="1507845453">
<p style="display: none;"></p>			<input type="hidden" id="ak_js" name="ak_js" value="1577054179613"></form>
			</div><!-- #respond -->
	<div style="clear: both"></div>
</div><!-- .comments-area -->

	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/05/11/openlayers-align-label-with-line-feature/" rel="prev"><span class="meta-nav" aria-hidden="true">Previous</span> <span class="screen-reader-text">Previous post:</span> <span class="post-title">OpenLayers: Align label with Line&nbsp;Feature</span></a></div><div class="nav-next"><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/2017/06/04/the-definitive-guide-to-google-maps-markers/" rel="next"><span class="meta-nav" aria-hidden="true">Next</span> <span class="screen-reader-text">Next post:</span> <span class="post-title">The Definitive Guide to Google Maps&nbsp;Markers</span></a></div></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	</div><!-- .site-content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="site-info">
						<a href="https://web.archive.org/web/20171012215728/https://wordpress.com/?ref=footer_custom_powered">Powered by WordPress.com</a>.
		</div><!-- .site-info -->
	</footer><!-- .site-footer -->

</div><!-- .site -->

<!--  -->
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/gprofiles.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/wpgroho.js"></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	</div>
<script type="text/javascript">
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.wordpress.com\/wp-login.php?action=logout&_wpnonce=ce6a424b5e","homeURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.com\/","postID":"121","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"0","userIsLoggedIn":"","isJetpack":"0","text_direction":"ltr"};
/* ]]> */
</script>
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/a_002.js"></script>

	<div id="carousel-reblog-box">
		<form action="#" name="carousel-reblog">
			<textarea id="carousel-reblog-content" name="carousel-reblog-content" placeholder="Add your thoughts here... (optional)"></textarea>
			<label for="carousel-reblog-to-blog-id" id="carousel-reblog-lblogid">Post to</label>
			<select name="carousel-reblog-to-blog-id" id="carousel-reblog-to-blog-id">
						</select>

			<div class="submit">
				<span class="canceltext"><a href="#" class="cancel">Cancel</a></span>
				<input type="submit" name="carousel-reblog-submit" class="button" id="carousel-reblog-submit" value="Reblog Post">
				<input type="hidden" id="carousel-reblog-blog-id" value="128658237">
				<input type="hidden" id="carousel-reblog-blog-url" value="https://onethinglab.com">
				<input type="hidden" id="carousel-reblog-blog-title" value="Blog about satisfying the programming itch...">
				<input type="hidden" id="carousel-reblog-post-url" value="">
				<input type="hidden" id="carousel-reblog-post-title" value="">
			</div>

			<input type="hidden" id="_wpnonce" name="_wpnonce" value="e96dcb4b10"><input type="hidden" name="_wp_http_referer" value="/2017/05/16/server-side-markers-clustering-using-postgresql-postgis-and-nodejs/">		</form>

		<div class="arrow"></div>
	</div>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.com\/2017\/05\/16\/server-side-markers-clustering-using-postgresql-postgis-and-nodejs\/":121};
	</script>
		<script type="text/javascript">
			var windowOpen;
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-twitter' ).on( 'click', function() {
				if ( 'undefined' !== typeof windowOpen ){ // If there's another sharing window open, close it.
					windowOpen.close();
				}
				windowOpen = window.open( jQuery(this).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
			var windowOpen;
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-facebook' ).on( 'click', function() {
				if ( 'undefined' !== typeof windowOpen ){ // If there's another sharing window open, close it.
					windowOpen.close();
				}
				windowOpen = window.open( jQuery(this).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
			var windowOpen;
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-google-plus-1' ).on( 'click', function() {
				if ( 'undefined' !== typeof windowOpen ){ // If there's another sharing window open, close it.
					windowOpen.close();
				}
				windowOpen = window.open( jQuery(this).attr( 'href' ), 'wpcomgoogle-plus-1', 'menubar=1,resizable=1,width=480,height=550' );
				return false;
			});
		});
		</script>
		<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/a.html"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://web.archive.org/web/20171012215728/https://s0.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://web.archive.org/web/20171012215728/https://s0.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414h&amp;ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

// Infinite scroll support
jQuery( function( $ ) {
	$( document.body ).on( 'post-load', function() {
		SyntaxHighlighter.highlight();
	} );
} );
</script>
<link rel="stylesheet" id="all-css-0-3" href="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/jetpack-carousel.css" type="text/css" media="all">
<!--[if lte IE 8]>
<link rel='stylesheet' id='jetpack-carousel-ie8fix-css'  href='https://s1.wp.com/wp-content/mu-plugins/carousel/jetpack-carousel-ie8fix.css?m=1412618825h&#038;ver=20121024' type='text/css' media='all' />
<![endif]-->
<script type="text/javascript">
/* <![CDATA[ */
var comment_like_text = {"loading":"Loading..."};
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
var screenReaderText = {"expand":"<span class=\"screen-reader-text\">expand child menu<\/span>","collapse":"<span class=\"screen-reader-text\">collapse child menu<\/span>"};
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
var actionbardata = {"siteID":"128658237","siteName":"Blog about satisfying the programming itch...","siteURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.com\/","icon":"<img alt='' src='https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.files.wordpress.com\/2017\/05\/cropped-site_icon.png?w=50' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/twentyfifteen","signupURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fonethinglab.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F","themeURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/wordpress.com\/theme\/twentyfifteen\/","xhrURL":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.com\/wp-admin\/admin-ajax.php","nonce":"40bcd9aacc","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"efa2ddea78\" \/>","referer":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.com\/2017\/05\/16\/server-side-markers-clustering-using-postgresql-postgis-and-nodejs\/","canFollow":"1","feedID":"65463709","statusMessage":"","customizeLink":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fonethinglab.wordpress.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F","postID":"121","shortlink":"https:\/\/web.archive.org\/web\/20171012215728\/http:\/\/wp.me\/p8HPSR-1X","canEditPost":"","editLink":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/wordpress.com\/post\/onethinglab.com\/121","statsLink":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/wordpress.com\/stats\/post\/121\/onethinglab.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: Twenty Fifteen","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/onethinglab.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fonethinglab.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.com\/wp-admin\/admin-ajax.php","nonce":"80d1488a62","display_exif":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/web.archive.org\/web\/20171012215728\/https:\/\/onethinglab.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fonethinglab.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F","blog_id":"128658237","local_comments_commenting_as":"<fieldset><label for=\"email\">Email (Required)<\/label> <input type=\"text\" name=\"email\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-email-field\" \/><\/fieldset><fieldset><label for=\"author\">Name (Required)<\/label> <input type=\"text\" name=\"author\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-author-field\" \/><\/fieldset><fieldset><label for=\"url\">Website<\/label> <input type=\"text\" name=\"url\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-url-field\" \/><\/fieldset>","reblog":"Reblog","reblogged":"Reblogged","reblog_add_thoughts":"Add your thoughts here... (optional)","reblogging":"Reblogging...","post_reblog":"Post Reblog","stats_query_args":"blog=128658237&v=wpcom&tz=0&user_id=0&subd=onethinglab","is_public":"1","reblog_enabled":""};
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/a.js"></script><div id="actionbar" class="actnbr-pub-twentyfifteen actnbr-has-follow"><ul><li class="actnbr-btn actnbr-hidden"> 			    	<a class="actnbr-action actnbr-actn-follow" href=""><svg class="gridicon gridicon__follow" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M23 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3zM20 2v9h-4v3h-3v4H4c-1.1 0-2-.9-2-2V2h18zM8 13v-1H4v1h4zm3-3H4v1h7v-1zm0-2H4v1h7V8zm7-4H4v2h14V4z"></path></g></svg><span>Follow</span></a> 			    	<div class="actnbr-popover tip tip-top-left actnbr-notice"> 			    		<div class="tip-arrow"></div> 			    		<div class="tip-inner actnbr-follow-bubble"></div> 			    	</div> 			    </li><li class="actnbr-ellipsis actnbr-hidden"> 			  <svg class="gridicon gridicon__ellipsis" height="24" width="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><circle cx="5" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="12" cy="12" r="2"></circle></g></svg> 			  <div class="actnbr-popover tip tip-top-left actnbr-more"> 			  	<div class="tip-arrow"></div> 			  	<div class="tip-inner"> 				  <ul> 				    <li class="actnbr-sitename actnbr-hidden"><a href="https://web.archive.org/web/20171012215728/https://onethinglab.com/"><img alt="" src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/cropped-site_icon.png" class="avatar avatar-50" width="50" height="50"> Blog about satisfying the programming itch...</a></li> 				   	<li class="actnbr-folded-customize actnbr-hidden"><a href="https://web.archive.org/web/20171012215728/https://onethinglab.wordpress.com/wp-admin/customize.php?url=https%3A%2F%2Fonethinglab.wordpress.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F"><svg class="gridicon gridicon__customize" height="20px" width="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M2 6c0-1.505.78-3.08 2-4 0 .845.69 2 2 2 1.657 0 3 1.343 3 3 0 .386-.08.752-.212 1.09.74.594 1.476 1.19 2.19 1.81L8.9 11.98c-.62-.716-1.214-1.454-1.807-2.192C6.753 9.92 6.387 10 6 10c-2.21 0-4-1.79-4-4zm12.152 6.848l1.34-1.34c.607.304 1.283.492 2.008.492 2.485 0 4.5-2.015 4.5-4.5 0-.725-.188-1.4-.493-2.007L18 9l-2-2 3.507-3.507C18.9 3.188 18.225 3 17.5 3 15.015 3 13 5.015 13 7.5c0 .725.188 1.4.493 2.007L3 20l2 2 6.848-6.848c1.885 1.928 3.874 3.753 5.977 5.45l1.425 1.148 1.5-1.5-1.15-1.425c-1.695-2.103-3.52-4.092-5.448-5.977z" data-reactid=".2.1.1:0.1b.0"></path></g></svg><span>Customize<span></span></span></a></li> 				    <li class="actnbr-folded-follow actnbr-hidden"><a class="actnbr-action actnbr-actn-follow" href=""><svg class="gridicon gridicon__follow" height="24px" width="24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g><path d="M23 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3zM20 2v9h-4v3h-3v4H4c-1.1 0-2-.9-2-2V2h18zM8 13v-1H4v1h4zm3-3H4v1h7v-1zm0-2H4v1h7V8zm7-4H4v2h14V4z"></path></g></svg><span>Follow</span></a></li> 					<li class="actnbr-signup actnbr-hidden"><a href="https://web.archive.org/web/20171012215728/https://wordpress.com/start/">Sign up</a></li> 				    <li class="actnbr-login actnbr-hidden"><a href="https://web.archive.org/web/20171012215728/https://onethinglab.wordpress.com/wp-login.php?redirect_to=https%3A%2F%2Fonethinglab.com%2F2017%2F05%2F16%2Fserver-side-markers-clustering-using-postgresql-postgis-and-nodejs%2F">Log in</a></li> 				     				    <li class="actnbr-shortlink actnbr-hidden"><a href="https://web.archive.org/web/20171012215728/http://wp.me/p8HPSR-1X">Copy shortlink</a></li> 				    <li class="flb-report actnbr-hidden"><a href="https://web.archive.org/web/20171007162017/http://en.wordpress.com/abuse/">Report this content</a></li> 				     				     				    <li class="actnbr-subs actnbr-hidden"><a href="https://web.archive.org/web/20171007162017/https://subscribe.wordpress.com/">Manage subscriptions</a></li> 				    <li class="actnbr-fold actnbr-hidden"><a href="">Collapse this bar</a></li> 			      </ul> 			    </div> 		      </div> 		    </li> 	      </ul></div>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>		<iframe src="https://web.archive.org/web/20171012215728if_/https://widgets.wp.com/likes/master.html?ver=20170206#ver=20170206" scrolling="no" id="likes-master" name="likes-master" style="display:none;"></iframe>
		<div id="likes-other-gravatars"><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
<script src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/w.js" type="text/javascript" async="" defer="defer"></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'128658237','blog_tz':'0','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'128658237','v':'wpcom','tz':'0','user_id':'0','post':'121','subd':'onethinglab'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5PVZEZGpQNVhfSjd4SHV4cEZ5aUNHMDlsOWM/LWxpbkR6NERVdkhxRkZUK0s/OWglNnc0Y11NZD0mZDZoeV9vZCxLUGZsNWFLdFA2W0dlQithdXlaQj90LWFMd0pCVC9vMGhhZWNPLzdObkxNRHE4enJYcHpaaUl6UlhqUGN6VV9zdXpyfjl+QUhQenJROXIrJTh8fnFdOCtCN19uMGZ1SVloLUN8JmJ3WHpPQkl6azJVTDNUJlpQMWJkMUNHYktEfls9ZmN1ZkpvUWYmSmVhU3ouWTVsLnFpLXY3WTBLMT9bbndPbiw9PThRSy5tLUx1WD9zR2NqbTh8LFpLPw=='}]);
_stq.push([ 'clickTrackerInit', '128658237', '121' ]);
	</script>
<noscript><img src="https://web.archive.org/web/20171012215728im_/https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt=""/></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//web.archive.org/web/20171012215728/https://pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>



<div class="comment-likes-overlay" style="display: none;"></div><img src="Server-side%20Markers%20clustering%20using%20PostgreSQL%20+%20PostGIS%20and%20NodeJS%20%E2%80%93%20Blog%20about%20satisfying%20the%20programming%20itch%E2%80%A6_files/g.gif" alt=":)" id="wpstats" style="display: none !important;" hidden=""><div class="fbc-badge js-fbc-UID_1 fbc-badge-small fbc-badge-share" style="z-index: 2; left: 684.083px; top: 21451.3px;"><div class="fbc-badge-fence"></div><div class="fbc-badge-tooltip">Facebook Container has disabled this button and blocked Facebook from tracking your visit to this page.</div><div class="fbc-badge-prompt"></div></div></body></html>
<!--
     FILE ARCHIVED ON 21:57:28 Oct 12, 2017 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 22:36:12 Dec 22, 2019.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  RedisCDXSource: 62.33
  esindex: 0.013
  PetaboxLoader3.datanode: 144.805 (4)
  captures_list: 321.034
  LoadShardBlock: 242.526 (3)
  PetaboxLoader3.resolve: 129.685 (3)
  exclusion.robots.policy: 0.143
  exclusion.robots: 0.171
  load_resource: 113.834
  CDXLines.iter: 12.969 (3)
-->